<!doctype html>
<html>
	<head>
		<title>Demo page - preview shapefile </title>
		<meta http-equiv="Content-Type" content="charset=UTF-8" />
		<meta name="author" content="Gipong">
		<meta name="keywords" content="shapefile,dbf,geojson,preview,shp2geojson">
	</head>
	<body>
	<span id="forkongithub"><a href="https://github.com/gipong/shp2geojson.js">Fork me on GitHub</a></span>
	<div id="fullpage">

		<div class="section"><div class="ui page grid">

			<div class="sixteen wide column">
				<h2 class="ui center aligned icon header">
					<img style="width: 68%" src="demo/shp2geojson.svg">
					<div class="content">shp2geojson.js</div>
				</h2>
			</div>
			<div class="three wide column"></div>
			<div class="ten wide aligned column">
							
				<div class="ui form segment">
					<div class="field ui labeled input">
						<div class="ui label">EPSG</div>
						<input type="text" placeholder="4326" id="epsg">
					</div>
					<div class="field ui labeled input">
						<div class="ui label">Encoding</div>
						<input type="text" placeholder="UTF-8" id="encoding">
					</div>
					<div class="two fields">
					
					<div class="right field"><div class="ui blue fluid labeled icon button" data-content="Metadata : EPSG: 3826, Encoding: big5" data-variation="inverted large" id="downloadfile">
						<i class="download icon"></i>Download TestData
					</div></div>

					<div class="field"><div class="ui teal fluid labeled icon button upload" id="zipfile" data-content="Mandatory files : SHP , DBF" data-variation="inverted large">
							Upload zip file
							<i class="add icon"></i>
							<input type="file" id="file">
					</div></div>
					
					<div class="ui feed">   
						<div class="content">
							<div class="summary">
							Data Source <a href="http://data.tainan.gov.tw/dataset/tn-village">http://data.tainan.gov.tw/dataset/tn-village</a>.
							</div>
						</div> 
					</div>

					</div>
				</div>
				<div class="ui inverted dimmer">
					<div class="ui large text loader">Loading</div>
				</div>

			</div>
			<div class="three wide column"></div>

			<div class="ui small modal">
				<i class="close icon"></i>
				<div class="header">Error Messages</div>
				<div class="content">
					<div class="image"><i class="file archive outline icon"></i></div>
					<div class="description">
						<p>Sorry, this format are not supported.</p>
					</div>
				</div>
				<div class="actions"><div class="ui red button">
					<i class="remove icon"></i>Cancel
				</div></div>
			</div>

	 	</div></div>

		<div class="section"><div class="ui page grid">
		
			<div class="ten wide column center aligned">
				<div id="map" style="height: 500px; weight: 100%"></div>
				</br>
				<div id="addZipfile" class="ui right labeled icon button">
					<i class="up arrow icon"></i>
					Upload another zip file
				</div>
				<div id="removeLayer" class="negative ui button">Remove Geojson Layer</div>
			</div>
			<div class="six wide column">
			<div class="tableDisplay"><table id="attribute" class="ui small celled unstackable table">
				<thead id="attrHead"><tr class="center aligned"><th>Attribute</th><th>Value</th></tr></thead>
				<tbody class="tbodyContent"></tbody>
			</table></div>
			</div>

		</div></div>

	</div> <!-- fullpage end -->
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
	<link rel="stylesheet" href="demo/semantic.min.css"></link>
	<link rel="stylesheet" href="demo/demo.css"></link>
	<link rel="stylesheet" href="demo/jquery.fullPage.css"></link>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.3/proj4.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script src="demo/jquery.fullPage.js"></script>
	<script src="lib/jszip.js"></script>
	<script src="lib/jszip-utils.js"></script>
	<!--[if IE]>
	<script type="text/javascript" src="lib/jszip-utils-ie.js"></script>
	<![endif]-->
	<script src="demo/semantic.min.js"></script>
	<script src="preprocess.js"></script>
	<script src="preview.js"></script>
	<script type="text/javascript" charset="UTF-8"> 
	$(document).ready(function() {
		$('#fullpage').fullpage({
			navigation: true,
			navigationPosition: 'right'
		});
		
		var map = L.map('map').setView([ 23.05, 120.191 ], 10);
		L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png' , { maxZoom: 18}).addTo(map);

		var vector = L.geoJson([], {
			style: function (feature) {
				return feature.properties.style;
			},
			onEachFeature: function (feature, layer) {
				
				layer.on({click: function(e) {
					vector.eachLayer(function(l) {
						vector.resetStyle(l);
					});
									
					$('.tbodyContent').remove();
					var tbody = '<tbody class="tbodyContent">';
					for (var key in e.target.feature.properties) {
						tbody += 
							('<tr class="center aligned"><td>'+ key + '</td><td>' + e.target.feature.properties[key] + '</td></tr>');
					}
					$('#attribute').append(tbody + '</tbody>');
					map.panTo(e.latlng);

					if('setStyle' in e.target) e.target.setStyle({
						fillColor: '#FF0',
						fillOpacity: 0.6
					});
				}});
			}
		}).addTo(map);

		$("#file").change(function() {
			var epsg = ($('#epsg').val() == '') ? 4326 : $('#epsg').val(),
			encoding = ($('#encoding').val() == '') ? 'UTF-8' : $('#encoding').val()

			if(this.files[0].name.split('.')[1] == 'zip') {
				if(this.files[0]) $('.dimmer').addClass( "active" );
				loadshp({
					url: this.files[0],
					encoding: encoding,
					EPSG: epsg
				}, function(data) {
					$.fn.fullpage.moveTo(2);
					vector.addData(data);
					map.fitBounds(vector.getBounds());
					$('.dimmer').removeClass( "active" );
					$('#epsg').val('');
					$('#encoding').val('');
				});
			} else {
				$('.modal').modal('show');
			}
		});

		$('.button').popup({ 
			inline: true,
			position : 'bottom left'
		});
		$('#downloadfile').click(function() {
			window.location.href = 'demo/10tnvillage.zip';
		});
		$('#addZipfile').click(function() {
			$.fn.fullpage.moveTo(1);
		});
		$('#removeLayer').click(function() {
			map.removeLayer(vector);
		});
		
	});	
	</script>
	</body>
</html>

